<!DOCTYPE html>
<html lang="fr" translate="no">
<head translate="no">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interventions</title>
    <!-- Vos balises meta et liens vers des fichiers externes ici -->
</head>
<body>
<div class="tab">
    <div id="creerButton" class="tab-button" onclick="openTab('creer')">Créer</div>
    <div id="interventionsButton" class="tab-button" onclick="openTab('interventions')">Interventions</div>
</div>



<div id="creerTab" class="tabcontent">
        <!-- Contenu de l'onglet "Créer" -->
        <div class="container">
            <h1>Choix du Lieux, Machine</h1>
 <button id="Actif" onclick="afficherChronos()">Afficher les crhonos</button>
    <input type="text" id="searchInput" placeholder="Rechercher un lieu..." oninput="searchLieu()">



            <ul id="lieux-list" class="lieux-list"></ul>
        </div>

    </div>
 

<div id="interventionsTab" class="tabcontent">
    <!-- Contenu de l'onglet "Interventions" -->
    <div class="container">
                <div class="buttons-container">
            <button onclick="exportToTxt()">Exporter les interventions</button>
            <button onclick="deleteCookies()">Supprimer les cookies</button>
        </div>
        <div id="enregistrements"></div>
        <!-- Ajout des nouveaux boutons -->

    </div>
</div>


</body>
</html>
<style>
#Actif{
    background-color: #3498db;
    color: #fff;
    border: none;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 5px;
}
    .tab {
        display: flex;
        background-color: #1e1e1e;
        color: #fff;

    }

    .tab-button {
        cursor: pointer;
        padding: 10px;
        flex: 1;
        box-sizing: border-box;
        text-align: center;
        background-color: ##333;
        color: #fff;
            border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    }

    /* Style pour le bouton actif */
/* Style pour le bouton actif */
.tab-button.active {
    background-color: #333;
    color: #FFF;
}


    /* Style pour le contenu des onglets */
    .tabcontent {
        display: none;
    }
    body {
    font-family: 'Arial', sans-serif;
    background-color: #1e1e1e; /* Fond sombre pour le corps de la page */
    color: #fff; /* Texte en blanc */

    padding: 0;
     overflow: hidden;
}

.container {
     max-width: 100%; /* Modification pour occuper la largeur totale sur les petits écrans */

    background-color: #333; /* Fond sombre pour le conteneur principal */
    padding: 20px;
border-bottom-right-radius: 20px; /* Rayon pour l'angle inférieur droit */
    border-bottom-left-radius: 20px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

h1 {
    color: #fff; /* Texte en blanc */
}

.lieux-list {
    list-style: none;
    padding: 10px;
    max-height: calc(88vh - 150px);
    overflow: auto;
    box-shadow: 0px 0px 20px rgba(100, 100, 100, 0.5); /* Ajoute une ombre légère */
    background:  rgba(0, 0, 0, 0.3); /* Éclaircit légèrement le fond */
    border-radius: 10px
}




.lieux-list li {
    background-color: #555; /* Fond sombre pour chaque élément de lieu */
    margin: 10px 0;
    padding: 15px;
    border-radius: 8px;
    cursor: pointer;
}

.lieux-list li button {
    background-color: #3498db;
    color: #fff;
    border: none;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 5px;
}

.lieux-list li button:hover {
    background-color: #2980b9;
}

.lieux-list li .modal-content {
    background-color: #333; /* Fond sombre pour le contenu de la modal */
    margin: 0.5% auto;
    padding: 20px;
    border: 1px solid #888;
    border-radius: 8px;
  }
}

.lieux-list li textarea {
    width: 100%;
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 4px;
}

/* Ajout d'un style pour le mode sombre lorsqu'un lieu est cliqué */

    #chrono .seconds {
        color: gray;
    }

    @media screen and (max-width: 600px) {
    /* Styles spécifiques aux petits écrans */
    .container {
        max-width: 100%;
        /* ... autres styles ... */


    }
}
#enregistrements {
    margin-top: 20px;
    max-height: calc(100vh - 150px);
    overflow: auto;
    box-shadow: 0px 0px 20px rgba(100, 100, 100, 0.5);
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 10px;
    line-height: 1.5; /* Espace entre les lignes */
}

#enregistrements p {
    margin: 5px 0; /* Force une marge de 5px en haut et en bas de chaque paragraphe */
    font-size: 18px; /* Modifiez la taille du texte selon vos besoins */
}

#searchInput {
    background-color: #CCC;
    border-radius: 8px;
    color: black;
   max-width: 100%; /* Utilisation de width pour définir la largeur */

    height: 30px;
}

.place-details {
    display: flex;
    flex-direction: column; /* Afficher les éléments en colonne */
}

/* Ajouter cette règle pour chaque bouton dans placeDetails */
.place-details button {
    margin-top: 10px; /* Ajouter un espace entre les boutons */
}
.buttons-container {
    margin-top: 20px; /* Espacement par rapport au contenu précédent */
}

.buttons-container button {
    padding: 10px;
    margin-right: 10px;
    background-color: #3498db;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
}

.buttons-container button:hover {
    background-color: #2980b9;
}
.search-container {
    margin-top: 10px;
    margin-bottom: 10px;
}

.search-container input {
    padding: 8px;
}

.search-container button {
    padding: 8px;
    cursor: pointer;
}

.lieux-list li {
    display: block; /* Assurez-vous que tous les éléments sont visibles par défaut */

    margin: 10px 0;
    padding: 15px;
    border-radius: 8px;
    cursor: pointer;
}

</style>



<script>

let timers = {};



        function formatTime(time) {
    return time < 10 ? '0' + time : time;
}
document.addEventListener("DOMContentLoaded", function () {
    chargerLieux();
    afficherEnregistrements();
    setDefaultTab(); // Appel de la fonction pour ouvrir l'onglet par défaut
});


function afficherEnregistrements() {
    const enregistrementsDiv = document.getElementById('enregistrements');
    const enregistrements = localStorage.getItem('enregistrements');

    if (enregistrements) {
        enregistrementsDiv.innerHTML = enregistrements;
    }
}
function setDefaultTab() {
    // Ouvrir l'onglet "Créer" par défaut
    openTab('creer');
}

function openTab(tabName) {
    var i, tabcontent, tabbuttons;

    // Cacher tous les onglets
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Retirer la classe "active" de tous les boutons
    tabbuttons = document.getElementsByClassName("tab-button");
    for (i = 0; i < tabbuttons.length; i++) {
        tabbuttons[i].classList.remove("active");
    }

    // Afficher l'onglet sélectionné
    document.getElementById(tabName + "Tab").style.display = "block";

    // Ajouter la classe "active" au bouton correspondant
    document.getElementById(tabName + "Button").classList.add("active");
}





function chargerLieux() {
    const randomParam = Math.random(); // Ajouter un paramètre aléatoire
    const url = `lieux.json?random=${randomParam}`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            const lieuxList = document.getElementById('lieux-list');
            lieuxList.innerHTML = '';

            data.forEach(nomLieu => {
                const lieuItem = document.createElement('li');
                lieuItem.innerHTML = `<div class="place-card" onclick="ouvrirModal('${nomLieu}')">
                                        <span class="pastille" id="pastille-${nomLieu}"></span>${nomLieu}
                                     </div>`;
                lieuxList.appendChild(lieuItem);
            });
        })
        .catch(error => console.error('Erreur de chargement des lieux', error));
}



function ouvrirModal(nomLieu) {


    // Find the corresponding list item
    const listItem = event.target.closest('li');
    const placeCard = listItem.querySelector('.place-card');
    const pastilleSpan = placeCard.querySelector('.pastille');

    // Ajoutez " - actif" à l'ancien texte
    pastilleSpan.textContent = pastilleSpan.textContent + 'Actif - ';

    const modalContent = document.createElement('div');
    modalContent.classList.add('modal-content');

    const placeDetails = document.createElement('div');
    placeDetails.classList.add('place-details');  // Ajouter une classe unique

    const chronoStatus = document.createElement('div');
    chronoStatus.classList.add('chrono-status');  // Ajouter une classe unique


    const chrono = document.createElement('div');
    chrono.id = 'chrono';
    chrono.textContent = '00:00:00';

    const zoneTexte = document.createElement('textarea');
    zoneTexte.id = 'zone-texte';
    zoneTexte.placeholder = 'Saisissez quelque chose...';

const annulerButton = document.createElement('button');
annulerButton.textContent = 'Annuler';
annulerButton.onclick = annuler;


 const pauseButton = document.createElement('button');
pauseButton.textContent = 'Pause';
pauseButton.style.backgroundColor = 'yellow';
pauseButton.style.color = 'black';
pauseButton.onclick = function () {
    togglePause(pauseButton, nomLieu);
};

const enregistrerButton = document.createElement('button');
enregistrerButton.textContent = 'Enregistrer';
enregistrerButton.style.backgroundColor = 'red';
enregistrerButton.style.color = 'black';  // La couleur du texte
enregistrerButton.onclick = function () {
    toggleSave(pauseButton, nomLieu);  // Correction du nom du bouton
};

    // Append elements to placeDetails
    placeDetails.appendChild(chronoStatus);
    placeDetails.appendChild(chrono);
    placeDetails.appendChild(zoneTexte);
    placeDetails.appendChild(annulerButton);
    placeDetails.appendChild(pauseButton);
    placeDetails.appendChild(enregistrerButton);

    // Append elements to modalContent
    modalContent.appendChild(placeDetails);


    listItem.appendChild(modalContent);

    // Clear previous content
    zoneTexte.value = '';

    // Create a basic timer
  let hours = 0;
    let minutes = 0;
    let seconds = 0;
    let timerInterval;

    timers[nomLieu] = {
        timerInterval: timerInterval,
        isPaused: false,
        hours: 0,
        minutes: 0,
        seconds: 0
    };

    // Update the timer display every second
 timerInterval = setInterval(() => {
        if (!timers[nomLieu].isPaused) {
            seconds++;
            if (seconds === 60) {
                minutes++;
                seconds = 0;
            }
            if (minutes === 60) {
                hours++;
                minutes = 0;
            }

            chrono.textContent = formatTime(hours) + ':' + formatTime(minutes) + ':' + formatTime(seconds);
        }
    }, 1000);

    // Update the timer status
    chronoStatus.textContent = 'En cours';
    chronoStatus.style.color = 'green';

    // Function to format time as '00'

    // Store the interval ID and pause state in a data attribute
    timers[nomLieu] = {
        timerInterval: timerInterval,
        isPaused: false,
        chronoStatus: chronoStatus,
        chrono: chrono
    };

}



function togglePause(button, nomLieu) {
    const timer = timers[nomLieu];

    timer.isPaused = !timer.isPaused;

    if (timer.isPaused) {
        // Pause the timer
        clearInterval(timer.timerInterval);
        // Update the timer status
        timer.chronoStatus.textContent = 'En pause';
        timer.chronoStatus.style.color = 'yellow';
        // Change the button text to "Reprendre"
        button.textContent = 'Reprendre';
                button.style.backgroundColor = 'green';
        button.style.color = 'White';
    } else {
        // Resume the timer
        if (!timer.seconds) timer.seconds = 0;
        if (!timer.minutes) timer.minutes = 0;
        if (!timer.hours) timer.hours = 0;

        let startSeconds = timer.seconds;
        let startMinutes = timer.minutes;
        let startHours = timer.hours;

        timer.timerInterval = setInterval(() => {
            if (!timer.isPaused) {
                timer.seconds++;
                if (timer.seconds === 60) {
                    timer.minutes++;
                    timer.seconds = 0;
                }
                if (timer.minutes === 60) {
                    timer.hours++;
                    timer.minutes = 0;
                }

                // Utiliser la fonction formatTime ici
                timer.chrono.textContent = formatTime(timer.hours) + ':' + formatTime(timer.minutes) + ':' + formatTime(timer.seconds);
            }
        }, 1000);

        // Update the timer status
        timer.chronoStatus.textContent = 'En cours';
        timer.chronoStatus.style.color = 'green';
        // Change the button text back to "Pause"
        button.textContent = 'Pause';
        button.style.backgroundColor = 'yellow';
        button.style.color = 'Black';
    }
}

function toggleSave(button, nomLieu) {
    const modalContent = event.target.closest('.modal-content');


    // Stop the timer
    const timer = timers[nomLieu];
    timer.isPaused = !timer.isPaused;
    clearInterval(timer.timerInterval);

    // Update the timer status
    const chronoStatus = modalContent.querySelector('.chrono-status');
    chronoStatus.textContent = 'Fini';
    chronoStatus.style.color = 'red';

    // Retrieve the text from the textarea
    const zoneTexte = modalContent.querySelector('#zone-texte');
    const texteEnregistre = zoneTexte.value;

    // Check if the textarea is not empty
    if (texteEnregistre.trim() !== "") {
        // Get the current date
        const currentDate = new Date();
        const formattedDate = `${currentDate.getDate()}/${currentDate.getMonth() + 1}/${currentDate.getFullYear()}`;

        // Ask for confirmation before clearing the textarea
        const confirmation = window.confirm(`Voulez-vous vraiment enregistrer le texte du ${formattedDate} ?\nCela effacera le contenu actuel.`);

        if (confirmation) {
            // Display the pastille and recorded information

    const enregistrementsDiv = document.getElementById('enregistrements');
    const tempsEnregistre = timer.chrono.textContent;
    const currentDate = new Date();
    const formattedDate = `${currentDate.getDate()}/${currentDate.getMonth() + 1}/${currentDate.getFullYear()}`;
    const enregistrementTexte = `${formattedDate} - ${tempsEnregistre} - ${nomLieu} - ${texteEnregistre}`;
    enregistrementsDiv.innerHTML += `<p>${enregistrementTexte}</p>`;

    // Save the information to localStorage
    sauvegarderEnregistrement(enregistrementTexte);

    fermerModal(modalContent);


        }
    } else {
        // Show a message if the textarea is empty
        alert("Le contenu est vide. Veuillez entrer du texte avant d'enregistrer.");
    }

    // Reset the button styles
    button.textContent = 'Reprendre';
    button.style.backgroundColor = 'green';
    button.style.color = 'white';
}

function sauvegarderEnregistrement(enregistrement) {
    const enregistrementsDiv = document.getElementById('enregistrements');
    const enregistrements = localStorage.getItem('enregistrements') || "";
    const nouvelEnregistrement = `${enregistrements}${enregistrement}<br>`;
    localStorage.setItem('enregistrements', nouvelEnregistrement);
}


function annuler() {
    // Afficher la confirmation
    const confirmation = window.confirm('Êtes-vous sûr de vouloir annuler ?');

    // Si l'utilisateur clique sur "OK" dans la confirmation, fermer la modal
    if (confirmation) {
        const modalContent = event.target.closest('.modal-content');
        fermerModal(modalContent);
    }
    // Sinon, ne rien faire
}

function fermerModal(modalContent) {
    // Clear the interval when closing the modal
    const nomLieu = modalContent.getAttribute('data-nom-lieu');

    // Remove the modal content from its parent
    modalContent.parentNode.removeChild(modalContent);
}





function exportToTxt() {
    const enregistrementsDiv = document.getElementById('enregistrements');
    const enregistrementsData = enregistrementsDiv.innerText;

    // Créer un objet Date pour obtenir la date d'aujourd'hui
    const currentDate = new Date();
    const formattedDate = `${currentDate.getDate()}-${currentDate.getMonth() + 1}-${currentDate.getFullYear()}`;

    // Générer le contenu du fichier texte avec la date et les enregistrements
    const fileContent = `Export du ${formattedDate}\n\n${enregistrementsData}`;

    // Créer un objet Blob pour le contenu du fichier
    const blob = new Blob([fileContent], { type: 'text/plain' });

    // Créer un objet URL pour le Blob
    const url = URL.createObjectURL(blob);

    // Créer un élément de lien pour déclencher le téléchargement
    const link = document.createElement('a');
    link.href = url;
    link.download = `export_${formattedDate}.txt`;

    // Ajouter le lien à la page et déclencher le téléchargement
    document.body.appendChild(link);
    link.click();

    // Retirer le lien de la page une fois le téléchargement terminé
    document.body.removeChild(link);
}



function deleteCookies() {
    // Demander une confirmation avant de supprimer tous les enregistrements
    const confirmation = window.confirm("Êtes-vous sûr de vouloir supprimer tous les enregistrements ?");

    if (confirmation) {
        // Supprimer tous les enregistrements dans localStorage
        localStorage.removeItem('enregistrements');

        // Rafraîchir ou mettre à jour l'affichage des enregistrements
        location.reload();

        alert("Tous les enregistrements ont été supprimés");
    }
}


function searchLieu() {
    const searchInput = document.getElementById('searchInput');
    const searchTerm = searchInput.value.toLowerCase();

    const lieuxList = document.getElementById('lieux-list');
    const lieuxItems = lieuxList.getElementsByTagName('li');

    // Parcourir la liste des lieux
    for (let i = 0; i < lieuxItems.length; i++) {
        const lieuName = lieuxItems[i].innerText.toLowerCase();

        // Utiliser une expression régulière pour chercher le terme de recherche n'importe où dans le texte
        const regex = new RegExp(searchTerm, 'i');
        
        if (lieuName.match(regex)) {
            // Afficher l'élément trouvé
            lieuxItems[i].style.display = 'block';
            lieuxItems[i].classList.add('active');
        } else {
            // Cacher les éléments qui ne correspondent pas
            lieuxItems[i].style.display = 'none';
            lieuxItems[i].classList.remove('active');
        }
    }
}
        window.addEventListener('beforeunload', function (event) {
            // Votre logique de sauvegarde ou l'alerte ici
            var confirmationMessage = "Les crhono ne seront pas sauvegarder. Êtes-vous sûr de vouloir actualiser/quitter la page ?";
            
            // Standard pour la plupart des navigateurs
            if (typeof event === 'undefined') {
                event = window.event;
            }
            
            if (event) {
                event.returnValue = confirmationMessage;
            }
            
            return confirmationMessage;
        });



function afficherChronos() {
    const lieuxList = document.getElementById('lieux-list');
    const lieuxItems = lieuxList.getElementsByTagName('li');

    // Mettre à jour la valeur de la zone de recherche avec "Actif"
    const searchInput = document.getElementById('searchInput');
    searchInput.value = 'actif';

    // Parcourir la liste des lieux
    for (let i = 0; i < lieuxItems.length; i++) {
        const lieuName = lieuxItems[i].innerText.toLowerCase();

        // Vérifier si le lieu contient "Actif" dans son nom
        if (lieuName.includes('actif')) {
            // Afficher l'élément
            lieuxItems[i].style.display = 'block';
            lieuxItems[i].classList.add('active');
        } else {
            // Cacher les éléments qui ne contiennent pas "Actif"
            lieuxItems[i].style.display = 'none';
            lieuxItems[i].classList.remove('active');
        }
    }
}


</script>