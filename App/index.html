<!DOCTYPE html>
<html lang="fr" translate="no">
<head translate="no">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interventions</title>
    <!-- Vos balises meta et liens vers des fichiers externes ici -->
</head>
<body>
    <div class="container">
        <h1>Liste des lieux</h1>
        <ul id="lieux-list" class="lieux-list"></ul>
    </div>




</body>
</html>
<style>
    body {
    font-family: 'Arial', sans-serif;
    background-color: #1e1e1e; /* Fond sombre pour le corps de la page */
    color: #fff; /* Texte en blanc */
    margin: 0;
    padding: 0;
}

.container {
     max-width: 100%; /* Modification pour occuper la largeur totale sur les petits écrans */
    margin: 10px auto;
    background-color: #333; /* Fond sombre pour le conteneur principal */
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

h1 {
    color: #fff; /* Texte en blanc */
}

.lieux-list {
    list-style: none;
    padding: 0;
}

.lieux-list li {
    background-color: #555; /* Fond sombre pour chaque élément de lieu */
    margin: 10px 0;
    padding: 15px;
    border-radius: 8px;
    cursor: pointer;
}

.lieux-list li button {
    background-color: #3498db;
    color: #fff;
    border: none;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 5px;
}

.lieux-list li button:hover {
    background-color: #2980b9;
}

.lieux-list li .modal-content {
    background-color: #333; /* Fond sombre pour le contenu de la modal */
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
  }
}

.lieux-list li textarea {
    width: 100%;
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 4px;
}

/* Ajout d'un style pour le mode sombre lorsqu'un lieu est cliqué */
.lieux-list li.active {
    background-color: #2c3e50; /* Fond sombre pour l'élément de lieu actif */
}
    #chrono .seconds {
        color: gray;
    }

    @media screen and (max-width: 600px) {
    /* Styles spécifiques aux petits écrans */
    .container {
        max-width: 100%;
        /* ... autres styles ... */
    }
}
</style>



<script>

let timers = {};

        function formatTime(time) {
    return time < 10 ? '0' + time : time;
}
document.addEventListener("DOMContentLoaded", function () {
    // Prompt the user for credentials
    chargerLieux();
});

function chargerLieux() {
    fetch('lieux.json')
        .then(response => response.json())
        .then(data => {
            const lieuxList = document.getElementById('lieux-list');
            lieuxList.innerHTML = '';

            data.forEach(nomLieu => {
                const lieuItem = document.createElement('li');
                lieuItem.innerHTML = `<div class="place-card" onclick="ouvrirModal('${nomLieu}')">${nomLieu}</div>`;
                lieuxList.appendChild(lieuItem);
            });
        })
        .catch(error => console.error('Erreur de chargement des lieux', error));
}

function ouvrirModal(nomLieu) {

    // Find the corresponding list item
    const listItem = event.target.closest('li');

   // Create a new modal content
    const modalContent = document.createElement('div');
    modalContent.classList.add('modal-content');

    const placeDetails = document.createElement('div');
    placeDetails.classList.add('place-details');  // Ajouter une classe unique

    const chronoStatus = document.createElement('div');
    chronoStatus.classList.add('chrono-status');  // Ajouter une classe unique


    const chrono = document.createElement('div');
    chrono.id = 'chrono';
    chrono.textContent = '00:00:00';

    const zoneTexte = document.createElement('textarea');
    zoneTexte.id = 'zone-texte';
    zoneTexte.placeholder = 'Saisissez quelque chose...';

const annulerButton = document.createElement('button');
annulerButton.textContent = 'Annuler';
annulerButton.onclick = annuler;


    const pauseButton = document.createElement('button');
    pauseButton.textContent = 'Pause';
    pauseButton.onclick = function () {
        togglePause(pauseButton, nomLieu);
    };

    const enregistrerButton = document.createElement('button');
    enregistrerButton.textContent = 'Enregistrer';

    enregistrerButton.onclick = function () {
        toggleSave(pauseButton, nomLieu);
    };
    // Append elements to placeDetails
    placeDetails.appendChild(chronoStatus);
    placeDetails.appendChild(chrono);
    placeDetails.appendChild(zoneTexte);
    placeDetails.appendChild(annulerButton);
    placeDetails.appendChild(pauseButton);
    placeDetails.appendChild(enregistrerButton);

    // Append elements to modalContent
    modalContent.appendChild(placeDetails);


    listItem.appendChild(modalContent);

    // Clear previous content
    zoneTexte.value = '';

    // Create a basic timer
  let hours = 0;
    let minutes = 0;
    let seconds = 0;
    let timerInterval;

    timers[nomLieu] = {
        timerInterval: timerInterval,
        isPaused: false,
        hours: 0,
        minutes: 0,
        seconds: 0
    };

    // Update the timer display every second
 timerInterval = setInterval(() => {
        if (!timers[nomLieu].isPaused) {
            seconds++;
            if (seconds === 60) {
                minutes++;
                seconds = 0;
            }
            if (minutes === 60) {
                hours++;
                minutes = 0;
            }

            chrono.textContent = formatTime(hours) + ':' + formatTime(minutes) + ':' + formatTime(seconds);
        }
    }, 1000);

    // Update the timer status
    chronoStatus.textContent = 'En cours';
    chronoStatus.style.color = 'green';

    // Function to format time as '00'

    // Store the interval ID and pause state in a data attribute
    timers[nomLieu] = {
        timerInterval: timerInterval,
        isPaused: false,
        chronoStatus: chronoStatus,
        chrono: chrono
    };

}



function togglePause(button, nomLieu) {
    const timer = timers[nomLieu];

    timer.isPaused = !timer.isPaused;

    if (timer.isPaused) {
        // Pause the timer
        clearInterval(timer.timerInterval);
        // Update the timer status
        timer.chronoStatus.textContent = 'En pause';
        timer.chronoStatus.style.color = 'yellow';
        // Change the button text to "Reprendre"
        button.textContent = 'Reprendre';
    } else {
        // Resume the timer
        if (!timer.seconds) timer.seconds = 0;
        if (!timer.minutes) timer.minutes = 0;
        if (!timer.hours) timer.hours = 0;

        let startSeconds = timer.seconds;
        let startMinutes = timer.minutes;
        let startHours = timer.hours;

        timer.timerInterval = setInterval(() => {
            if (!timer.isPaused) {
                timer.seconds++;
                if (timer.seconds === 60) {
                    timer.minutes++;
                    timer.seconds = 0;
                }
                if (timer.minutes === 60) {
                    timer.hours++;
                    timer.minutes = 0;
                }

                // Utiliser la fonction formatTime ici
                timer.chrono.textContent = formatTime(timer.hours) + ':' + formatTime(timer.minutes) + ':' + formatTime(timer.seconds);
            }
        }, 1000);

        // Update the timer status
        timer.chronoStatus.textContent = 'En cours';
        timer.chronoStatus.style.color = 'green';
        // Change the button text back to "Pause"
        button.textContent = 'Pause';
    }
}

function toggleSave(button, nomLieu) {
    const modalContent = event.target.closest('.modal-content');

    // Stop the timer

    const timer = timers[nomLieu];


        clearInterval(timer.timerInterval);

        // Update the timer status
        const chronoStatus = modalContent.querySelector('#chrono-status');
        timer.chronoStatus.textContent = 'Fini';
        timer.chronoStatus.style.color = 'red';

        // TODO: Ajouter la logique pour enregistrer l'action

        // Exemple : récupérer le texte de la zone de texte
        const zoneTexte = modalContent.querySelector('#zone-texte');
        const texteEnregistre = zoneTexte.value;

        // Exemple de log pour montrer que le texte a été enregistré
        console.log(`Action enregistrée pour ${nomLieu}: ${texteEnregistre}`);
    
}



function annuler() {
    // Afficher la confirmation
    const confirmation = window.confirm('Êtes-vous sûr de vouloir annuler ?');

    // Si l'utilisateur clique sur "OK" dans la confirmation, fermer la modal
    if (confirmation) {
        const modalContent = event.target.closest('.modal-content');
        fermerModal(modalContent);
    }
    // Sinon, ne rien faire
}

function fermerModal(modalContent) {
    // Clear the interval when closing the modal
    const nomLieu = modalContent.getAttribute('data-nom-lieu');

    // Remove the modal content from its parent
    modalContent.parentNode.removeChild(modalContent);
}



function reprendre() {
    // TODO: Add logic for resuming the action
}






</script>